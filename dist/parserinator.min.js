"use strict";!function(){function r(){var r={api_root:null,api_version:null};this.setOptions=function(n){angular.extend(r,n)},this.$get=[function(){function n(){var r=void 0===arguments[0]?"":arguments[0];return 0===r.indexOf("http://")||0===r.indexOf("https://")}var e={generateApiUrl:function(r){var e=r.api_root,t=r.api_version,i=void 0;return e&&t?(i=""+e+"/"+t,n(e)?i:"http://"+i):void 0}};return e.full_api_url=e.generateApiUrl(r),e}]}function n(){var r={createIncludesParams:function(r){return r?"include="+r.join(","):""},createFieldsParams:function(r){var n=[],e=void 0;if(!r)return"";for(e in r)r.hasOwnProperty(e)&&n.push("fields["+e+"]="+r[e].join(","));return n.join("&")},createParams:function(){var r=void 0===arguments[0]?{}:arguments[0],n=r.includes,e=r.fields,t=this.createFieldsParams(e),i=t?"&"+t:"";return"?"+this.createIncludesParams(n)+i}};return r}function e(r,n,e,t){function i(){var r=void 0===arguments[0]?[]:arguments[0];return function(n){return _.findWhere(r,{id:n.id,type:n.type})}}function a(e){var i=void 0===arguments[1]?"API Error":arguments[1];return function(){var a=void 0===arguments[0]?{}:arguments[0],u=n.defer(),o=p+"/"+e,s=t.createParams(a),c=a.endpoint?"/"+a.endpoint:"";return o+=c+s+v,console.log("Request: "+o),r.jsonp(o,{cache:!0}).success(function(r){u.resolve(r)}).error(function(){u.reject(h+i)}),u.promise}}function u(r){var n=[];return r.length&&(n=_.map(r,o)),n}function o(){var r=void 0===arguments[0]?{}:arguments[0],n=angular.copy(r),e=n.relationships;return n=f(n,e)}function s(){}function c(r){var n={};return n=m(r),n&&n.relationships&&(n=f(n,n.relationship)),n}function d(r){var n=[],e={};return _.each(r,function(r){e=c(r),e?(e.relationships&&(e=f(e,e.relationships)),n.push(e)):s()}),n}function f(r,n){var e={},t=[],i=void 0,a=void 0;for(var u in n)n.hasOwnProperty(u)&&(i=n[u].data,i&&(Array.isArray(i)?(a=i[0].type,t=d(i),t.length&&(r[a]=t)):(e=c(i),e?(a=i.type,r[a]=e):s())));return r}var l=this,p=e.full_api_url,v="&callback=JSON_CALLBACK",h="Could not reach API: ",g={},m=void 0,y=void 0;return g.findTypesGenerator=function(){var r=void 0===arguments[0]?[]:arguments[0];return function(n){return _.filter(r,function(r){return r.type===n})}},g.get=function(r,n){return a(r,n)},g.parse=function(){var r=void 0===arguments[0]?{}:arguments[0],n=r.data,e=r.included?r.included:[],t=void 0;return m=i(e),t=Array.isArray(n)?u(n):o(n)},g.createHierarchy=function(){var r=void 0===arguments[0]?[]:arguments[0],n=void 0===arguments[1]?"":arguments[1],e=[],t=void 0,a=void 0,u=void 0;return y=l.findTypesGenerator(r),m=i(r),t=y(n),_.each(t,function(r){r.relationships&&r.relationships.parent?(a=m(r.relationships.parent.data),a&&(u=_.findWhere(e,{id:a.id}),a.children||(a.children=[]),_.findWhere(a.children,{id:r.id})||a.children.push(r),u||e.push(a))):(u=_.findWhere(e,{id:r.id}),u||e.push(r))}),e},g}n.$inject=[],e.$inject=["$http","$q","$jsonAPI","urlGenerator"],angular.module("parserinator",[]).provider("$jsonAPI",r).factory("jsonAPIParser",e).factory("urlGenerator",n)}();