"use strict";!function(){function r(){var r={api_root:null,api_version:null};this.setOptions=function(n){angular.extend(r,n)},this.$get=[function(){function n(){var r=void 0===arguments[0]?"":arguments[0];return 0===r.indexOf("http://")||0===r.indexOf("https://")}var t={generateApiUrl:function(r){var t=r.api_root,e=r.api_version,a=void 0;return t&&e?(a=""+t+"/"+e,n(t)?a:"http://"+a):void 0}};return t.full_api_url=t.generateApiUrl(r),t}]}function n(){var r={createIncludesParams:function(r){return r?"include="+r.join(","):""},createFieldsParams:function(r){var n=[],t=void 0;if(!r)return"";for(t in r)r.hasOwnProperty(t)&&n.push("fields["+t+"]="+r[t].join(","));return n.join("&")},createParams:function(){var r=void 0===arguments[0]?{}:arguments[0],n=r.includes,t=r.fields,e=this.createFieldsParams(t),a=e?"&"+e:"";return"?"+this.createIncludesParams(n)+a}};return r}function t(r,n,t,e){function a(){var r=void 0===arguments[0]?[]:arguments[0];return function(n){return _.findWhere(r,{id:n.id,type:n.type})}}function i(t){var a=void 0===arguments[1]?"API Error":arguments[1];return function(){var i=void 0===arguments[0]?{}:arguments[0],u=n.defer(),o=l+"/"+t,s=e.createParams(i),c=i.endpoint?"/"+i.endpoint:"";return o+=c+s+v,console.log("Request: "+o),r.jsonp(o,{cache:!0}).success(function(r){u.resolve(r)}).error(function(){u.reject(p+a)}),u.promise}}function u(r){var n=[];return r.length&&(n=_.map(r,o)),n}function o(){var r=void 0===arguments[0]?{}:arguments[0],n=angular.copy(r),t=n.relationships;return n=f(n,t)}function s(){}function c(r){var n={};return n=m(r),n&&n.relationships&&(n=f(n,n.relationship)),n}function d(r){var n=[],t={};return _.each(r,function(r){t=c(r),t?n.push(t):s()}),n}function f(r,n){var t={},e=[],a=void 0,i=void 0;for(var u in n)n.hasOwnProperty(u)&&(a=n[u].data,a&&(Array.isArray(a)?(i=a[0].type,e=d(a),e.length&&(r[i]=e)):(t=c(a),t?(i=a.type,r[i]=t):s())));return r}var l=t.full_api_url,v="&callback=JSON_CALLBACK",p="Could not reach API: ",g={},m=void 0;return g.get=function(r,n){return i(r,n)},g.parse=function(){var r=void 0===arguments[0]?{}:arguments[0],n=r.data,t=r.included?r.included:[],e=void 0;return m=a(t),e=Array.isArray(n)?u(n):o(n)},g}n.$inject=[],t.$inject=["$http","$q","$jsonAPI","urlGenerator"],angular.module("parserinator",[]).provider("$jsonAPI",r).factory("jsonAPIParser",t).factory("urlGenerator",n)}();