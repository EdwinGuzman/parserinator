"use strict";!function(){function r(){var r={api_root:null,api_version:null};this.setOptions=function(n){angular.extend(r,n)},this.$get=[function(){function n(){var r=void 0===arguments[0]?"":arguments[0];return 0===r.indexOf("http://")||0===r.indexOf("https://")}var t={generateApiUrl:function(r){var t=r.api_root,e=r.api_version,i=void 0;return t&&e?(i=""+t+"/"+e,n(t)?i:"http://"+i):void 0}};return t.full_api_url=t.generateApiUrl(r),t}]}function n(){var r={createIncludesParams:function(r){return r?"include="+r.join(","):""},createFieldsParams:function(r){var n=[],t=void 0;if(!r)return"";for(t in r)r.hasOwnProperty(t)&&n.push("fields["+t+"]="+r[t].join(","));return n.join("&")},createParams:function(){var r=void 0===arguments[0]?{}:arguments[0];console.log(r)}};return r}function t(r,n,t,e){function i(){var r=void 0===arguments[0]?[]:arguments[0];return function(n){return _.findWhere(r,{id:n.id,type:n.type})}}function a(t){var i=void 0===arguments[1]?"API Error":arguments[1];return function(){var a=void 0===arguments[0]?{}:arguments[0],o=n.defer(),u=d+"/"+t,s=e.createParams(a),c=a.endpoint?"/"+a.endpoint:"";return u+=c+s+v,console.log("Request: "+u),r.jsonp(u,{cache:!0}).success(function(r){o.resolve(r)}).error(function(){o.reject(p+i)}),o.promise}}function o(r){var n=[];return r.length&&_.each(r,function(r){n.push(u(r))}),n}function u(){var r=void 0===arguments[0]?{}:arguments[0],n=angular.copy(r),t=n.relationships;return n=l(n,t)}function s(){}function c(r){var n={};return n=h(r),n&&n.relationships&&(n=l(n,n.relationship)),n}function f(r){var n=[],t={};return _.each(r,function(r){t=c(r),t?n.push(t):s()}),n}function l(r,n){var t={},e=[],i=void 0,a=void 0;for(var o in n)n.hasOwnProperty(o)&&(i=n[o].data,i&&(Array.isArray(i)?(a=i[0].type,e=f(i),e.length&&(r[a]=e)):(t=c(i),t?(a=i.type,r[a]=t):s())));return r}var d=t.full_api_url,v="&callback=JSON_CALLBACK",p="Could not reach API: ",g={},h=void 0;return g.get=function(r,n){return a(r,n)},g.parse=function(){var r=void 0===arguments[0]?{}:arguments[0],n=r.data,t=r.included?r.included:[],e=void 0;return h=i(t),e=Array.isArray(n)?o(n):u(n)},g}n.$inject=[],t.$inject=["$http","$q","$jsonAPI","urlGenerator"],angular.module("parserinator",[]).provider("$jsonAPI",r).factory("jsonAPIParser",t).factory("urlGenerator",n)}();